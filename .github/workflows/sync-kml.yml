name: Sync KML to GitHub Pages (3:20pm ET exact)

on:
  schedule:
    # 20:20 UTC â‰ˆ 3:20 PM EST (invierno)
    - cron: "20 20 * * *"
    # 19:20 UTC â‰ˆ 3:20 PM EDT (verano)
    - cron: "20 19 * * *"
  workflow_dispatch:   # Permite ejecutarlo manualmente

permissions:
  contents: write

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Print times (UTC vs Eastern)
        shell: bash
        run: |
          echo "UTC now:      $(date -u +'%Y-%m-%d %H:%M:%S %Z')"
          echo "Eastern now:  $(TZ='America/New_York' date +'%Y-%m-%d %H:%M:%S %Z')"

      # ðŸ”’ Gate: solo continuar si AHORA en Eastern es 15:20
      - name: Enforce exact 15:20 ET
        shell: bash
        run: |
          HR=$(TZ="America/New_York" date +'%H')
          MN=$(TZ="America/New_York" date +'%M')
          if [ "$HR" != "15" ] || [ "$MN" != "20" ]; then
            echo "No es exactamente 15:20 ET. Saliendo (HR=$HR MN=$MN)."
            exit 0
          fi
          echo "Es 15:20 ET. Continuamos..."

      - name: Checkout KML branch
        uses: actions/checkout@v4
        with:
          ref: KML

      - name: Build source URL for today in US/Eastern
        id: vars
        shell: bash
        run: |
          set -euo pipefail
          TODAY_LOCAL=$(TZ="America/New_York" date +'%Y%m%d')
          echo "Hoy (ET): $TODAY_LOCAL"

          # PatrÃ³n: prb_72hsnow_ge02_YYYYMMDD12f072_40pct.kml
          SRC_URL="https://www.wpc.ncep.noaa.gov/pwpf_72hr/kml/snow/prb_72hsnow_ge02_${TODAY_LOCAL}12f072_40pct.kml"
